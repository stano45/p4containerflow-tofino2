#!/usr/bin/env bash
# Hardware config â€” multi-node experiment
#
# Copy this file or edit in place to match your testbed.
# All values can also be overridden via environment variables.

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/config.env"

# ---------------------------------------------------------------------------
# SSH targets (user@host)
# NOTE: Use direct assignment (not ${VAR:-default}) for values that override
# config.env, otherwise the base config values win.
# ---------------------------------------------------------------------------
LAKEWOOD_SSH=user@source-server
LOVELAND_SSH=user@target-server
TOFINO_SSH=user@tofino-switch
SSH_MUX_DIR="/tmp/p4cf-ssh-mux"
SSH_OPTS="-o BatchMode=yes -o StrictHostKeyChecking=no -o ConnectTimeout=10 -o ControlMaster=auto -o ControlPath=${SSH_MUX_DIR}/%r@%h:%p -o ControlPersist=600"

# ---------------------------------------------------------------------------
# Macvlan network on NICs connected to the switch (same L2 as P4 data plane)
# ---------------------------------------------------------------------------
HW_SUBNET=192.168.12.0/24
HW_GATEWAY=192.168.12.1
HW_NET=switch-net
LAKEWOOD_NIC=enp101s0np1
LOVELAND_NIC=enp101s0np1

# ---------------------------------------------------------------------------
# Direct server-to-server link (for checkpoint transfer, bypasses the switch)
# ---------------------------------------------------------------------------
LAKEWOOD_DIRECT_IP=192.168.10.2
LOVELAND_DIRECT_IP=192.168.10.3
LAKEWOOD_DIRECT_IF=enp179s0f0np0
LOVELAND_DIRECT_IF=enp179s0f0

# ---------------------------------------------------------------------------
# Host / container IPs on the switch subnet
# ---------------------------------------------------------------------------
VIP=192.168.12.10
H1_IP=192.168.12.100
H1_MAC=02:42:c0:a8:0c:64
H2_IP=192.168.12.2
H2_MAC=02:42:c0:a8:0c:02
H3_IP=192.168.12.3
H3_MAC=02:42:c0:a8:0c:03

# Macvlan-shim: host-side interface for host<->container communication.
# Without this, Linux macvlan isolation blocks host access to its own containers.
MACSHIM_IF=macshim

# ---------------------------------------------------------------------------
# Controller on the Tofino switch
# ---------------------------------------------------------------------------
CONTROLLER_URL=http://127.0.0.1:5000
CONTROLLER_CONFIG=controller_config_hw.json

# ---------------------------------------------------------------------------
# CRIU / Checkpoint
# ---------------------------------------------------------------------------
CHECKPOINT_DIR=/tmp/checkpoints
REMOTE_EDIT_SCRIPT=\$HOME/p4containerflow-tofino2/scripts/edit_files_img.py
REMOTE_EDIT_BIN=/tmp/edit_checkpoint
CR_SKIP_VERIFY=1
CR_SKIP_IMAGE_CHECK=1

# ---------------------------------------------------------------------------
# Experiment project root on lab nodes
# ---------------------------------------------------------------------------
REMOTE_PROJECT_DIR=\$HOME/p4containerflow-tofino2
