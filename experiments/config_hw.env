#!/usr/bin/env bash
# =============================================================================
# Hardware Configuration — Multi-Node Experiment
# =============================================================================
# Overrides for running across lakewood, loveland, and wedge100bf.
# Source INSTEAD of config.env — this file sources config.env internally
# and overrides what's needed.
#
# Usage:
#   source config_hw.env
# =============================================================================

# Load base defaults first
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/config.env"

# -----------------------------------------------------------------------------
# Network — all containers share one macvlan subnet on Netronome NICs
# -----------------------------------------------------------------------------
HW_SUBNET=192.168.12.0/24
HW_GATEWAY=192.168.12.1
HW_NET=switch-net

# Netronome NICs (physical interfaces for macvlan)
LAKEWOOD_NIC=${LAKEWOOD_NIC:-enp101s0np1}
LOVELAND_NIC=${LOVELAND_NIC:-enp101s0np0}

# -----------------------------------------------------------------------------
# Hosts — real IPs on the Netronome subnet
# -----------------------------------------------------------------------------
VIP=192.168.12.10

# Host 1: client (load generator) — on lakewood
H1_IP=192.168.12.100
H1_MAC=02:42:c0:a8:0c:64   # macvlan-generated

# Host 2: WebRTC server (initial) — on lakewood
H2_IP=192.168.12.2
H2_MAC=02:42:c0:a8:0c:02   # macvlan-generated

# Host 3: migration target — on loveland
H3_IP=192.168.12.3
H3_MAC=02:42:c0:a8:0c:03   # macvlan-generated

# -----------------------------------------------------------------------------
# SSH targets
# -----------------------------------------------------------------------------
LAKEWOOD_SSH=${LAKEWOOD_SSH:-stan@131.130.124.71}
LOVELAND_SSH=${LOVELAND_SSH:-stan@131.130.124.72}
TOFINO_SSH=${TOFINO_SSH:-stan@131.130.124.74}

# -----------------------------------------------------------------------------
# Controller — runs on the Tofino switch
# -----------------------------------------------------------------------------
CONTROLLER_URL=http://131.130.124.74:5000

# Controller config file (relative to controller/ dir)
CONTROLLER_CONFIG=controller_config_hw.json

# -----------------------------------------------------------------------------
# CRIU / Checkpoint — cross-node
# -----------------------------------------------------------------------------
CHECKPOINT_DIR=/tmp/checkpoints
REMOTE_CHECKPOINT_DIR=${REMOTE_CHECKPOINT_DIR:-/tmp/checkpoints}

# Path to edit_files_img.py — must exist on both lakewood AND loveland
EDIT_FILES_IMG=${EDIT_FILES_IMG:-../scripts/edit_files_img.py}

# Absolute path on remote node (loveland) for the edit script
REMOTE_EDIT_SCRIPT=${REMOTE_EDIT_SCRIPT:-/home/stan/projects/p4containerflow-tofino2/scripts/edit_files_img.py}

# -----------------------------------------------------------------------------
# Experiment project root on each node (for SSH commands)
# -----------------------------------------------------------------------------
REMOTE_PROJECT_DIR=${REMOTE_PROJECT_DIR:-/home/stan/projects/p4containerflow-tofino2}
